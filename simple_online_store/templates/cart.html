{% extends "layout.html" %}

{% block title %}Aurora Store � Cart{% endblock %}

{% block content %}
<section class="space-y-6">
    <div class="flex items-center justify-between gap-3">
        <div>
            <h1 class="text-xl font-semibold tracking-tight text-slate-50 sm:text-2xl">
                Your cart
            </h1>
            <p class="text-sm text-slate-300">
                Review your items, adjust quantities, and proceed to checkout.
            </p>
        </div>
        <a href="{{ url_for('index') }}" class="text-xs font-medium text-slate-300 underline-offset-2 hover:text-aurora-100 hover:underline">
            ? Continue shopping
        </a>
    </div>

    {% if not items %}
        <div class="rounded-3xl border border-dashed border-white/15 bg-slate-900/60 p-8 text-center text-slate-300">
            <p class="mb-2 text-sm font-medium">Your cart is empty.</p>
            <p class="mb-4 text-xs text-slate-400">Browse the catalog to add some products.</p>
            <a href="{{ url_for('index') }}" class="inline-flex items-center justify-center rounded-xl bg-aurora-500 px-4 py-2 text-xs font-semibold text-slate-50 shadow shadow-aurora-500/40 transition hover:bg-aurora-600">
                Shop products
            </a>
        </div>
    {% else %}
        <div class="grid gap-6 lg:grid-cols-[minmax(0,1.7fr)_minmax(0,1.1fr)]">
            <!-- Items -->
            <form method="post" action="{{ url_for('update_cart') }}" class="space-y-4">
                {% for item in items %}
                    <article class="flex gap-4 rounded-2xl border border-white/10 bg-slate-900/70 p-3 shadow-md shadow-black/30">
                        <a href="{{ url_for('product_detail', product_id=item.id) }}" class="shrink-0 overflow-hidden rounded-xl">
                            <img src="{{ item.image_url }}" alt="{{ item.name }}" class="h-24 w-24 object-cover transition duration-500 hover:scale-[1.04]">
                        </a>
                        <div class="flex flex-1 flex-col gap-2">
                            <div class="flex items-start justify-between gap-3">
                                <div>
                                    <h2 class="text-sm font-semibold text-slate-50">
                                        <a href="{{ url_for('product_detail', product_id=item.id) }}" class="hover:text-aurora-100">
                                            {{ item.name }}
                                        </a>
                                    </h2>
                                    <p class="text-xs text-slate-400">{{ item.category }}</p>
                                </div>
                                <form method="post" action="{{ url_for('remove_from_cart') }}">
                                    <input type="hidden" name="product_id" value="{{ item.id }}">
                                    <button type="submit" class="text-[0.7rem] font-medium text-slate-400 hover:text-rose-300">
                                        Remove
                                    </button>
                                </form>
                            </div>
                            <div class="flex flex-wrap items-end justify-between gap-3">
                                <div>
                                    <p class="text-xs text-slate-400">Unit price</p>
                                    <p class="text-sm font-semibold text-aurora-100">
                                        ${{ '%.2f'|format(item.price) }}
                                    </p>
                                </div>
                                <div>
                                    <label for="qty_{{ item.id }}" class="block text-[0.7rem] font-medium text-slate-300">
                                        Quantity
                                    </label>
                                    <input id="qty_{{ item.id }}" name="qty_{{ item.id }}" type="number" min="0" value="{{ item.quantity }}" class="mt-1 w-20 rounded-xl border border-white/10 bg-slate-900/80 px-3 py-1 text-xs text-slate-50 outline-none ring-aurora-500/40 focus:ring">
                                </div>
                                <div class="text-right">
                                    <p class="text-xs text-slate-400">Total</p>
                                    <p class="text-sm font-semibold text-slate-50">
                                        ${{ '%.2f'|format(item.line_total) }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </article>
                {% endfor %}

                <div class="flex items-center justify-between gap-3 text-xs text-slate-400">
                    <p>Set quantity to 0 to remove an item.</p>
                    <button type="submit" class="inline-flex items-center justify-center rounded-xl border border-white/15 bg-slate-950/70 px-3 py-1.5 text-xs font-semibold text-slate-100 transition hover:border-aurora-500/60 hover:text-aurora-100">
                        Update cart
                    </button>
                </div>
            </form>

            <!-- Summary -->
            <div class="space-y-4 rounded-3xl border border-white/10 bg-slate-950/70 p-4 shadow-lg shadow-black/40">
                <h2 class="text-sm font-semibold text-slate-50">Order summary</h2>
                <div class="space-y-2 text-sm text-slate-300">
                    <div class="flex justify-between">
                        <span>Subtotal</span>
                        <span>${{ '%.2f'|format(subtotal) }}</span>
                    </div>
                    <div class="flex justify-between text-slate-400">
                        <span>Shipping</span>
                        {% if shipping == 0 %}
                            <span>Free</span>
                        {% else %}
                            <span>${{ '%.2f'|format(shipping) }}</span>
                        {% endif %}
                    </div>
                    <div class="flex justify-between border-t border-white/10 pt-2 text-sm font-semibold text-slate-50">
                        <span>Total</span>
                        <span>${{ '%.2f'|format(total) }}</span>
                    </div>
                </div>

                <a href="{{ url_for('checkout') }}" class="block rounded-xl bg-aurora-500 px-4 py-2 text-center text-sm font-semibold text-slate-50 shadow-lg shadow-aurora-500/40 transition hover:-translate-y-0.5 hover:bg-aurora-600">
                    Proceed to checkout
                </a>
                <p class="text-[0.7rem] text-slate-400">
                    This is a prototype checkout � you can safely explore the flow
                    without real payments.
                </p>
            </div>
        </div>
    {% endif %}
</section>
{% endblock %}

